@model BrokerFinder.ViewModels.BrokerDetailsViewModel

@{
    ViewData["Title"] = "پروفایل کارگزار";
}

<div class="card">
    <div class="card-body">
        <h3>@Model.Broker.FullName</h3>
        <p>@Model.Broker.Description</p>
        <p><strong>تجربه:</strong> @Model.Broker.YearsOfExperience سال</p>
        <p><strong>ایمیل:</strong> @Model.Broker.Email</p>

        <h5>موقعیت روی نقشه</h5>
        @if (Model.Broker.Latitude != null && Model.Broker.Longitude != null)
        {
            <div id="map" style="height:300px"></div>
            <script>
                // Simple OpenStreetMap embed using iframe as lightweight
                const lat = @Model.Broker.Latitude;
                const lng = @Model.Broker.Longitude;
                const iframe = document.createElement('iframe');
                iframe.width = '100%';
                iframe.height = '300';
                iframe.frameBorder = 0;
                iframe.src = `https://www.openstreetmap.org/export/embed.html?bbox=${lng-0.05}%2C${lat-0.05}%2C${lng+0.05}%2C${lat+0.05}&layer=mapnik&marker=${lat}%2C${lng}`;
                document.getElementById('map').appendChild(iframe);
            </script>
        }
        else
        {
            <p>موقعیت ثبت نشده است.</p>
        }

        <h5 class="mt-3">اعتبارنامه ها</h5>
        <ul>
            @foreach(var c in Model.Credentials)
            {
                <li>@c.Title - @c.IssuerOrCompanyName</li>
            }
        </ul>

        <h5 class="mt-3">تماس با کارگزار</h5>
        @if(TempData["Message"] != null) { <div class="alert alert-success">@TempData["Message"]</div> }
        <form method="post" asp-action="Contact">
            <input type="hidden" name="brokerId" value="@Model.Broker.Id" />
            <div class="mb-3">
                <label class="form-label">ایمیل شما</label>
                <input name="contactEmail" class="form-control" required />
            </div>
            <div class="mb-3">
                <label class="form-label">پیام</label>
                <textarea name="message" rows="4" class="form-control"></textarea>
            </div>
            <button class="btn btn-primary">ارسال</button>
        </form>
    </div>
</div>